#!/usr/bin/env python3

__author__ = 'Frederic Escudie'
__copyright__ = 'Copyright (C) 2020 IUCT-O'
__license__ = 'GNU General Public License'
__version__ = '1.0.0'
__email__ = 'escudie.frederic@iuct-oncopole.fr'
__status__ = 'prod'

import os
import uuid
import tempfile
import unittest
import subprocess

TEST_DIR = os.path.dirname(os.path.abspath(__file__))
APP_DIR = os.path.dirname(TEST_DIR)
BIN_DIR = os.path.join(APP_DIR, "bin")
os.environ['PATH'] = BIN_DIR + os.pathsep + os.environ['PATH']


########################################################################
#
# FUNCTIONS
#
########################################################################
class TestNormalizeBND(unittest.TestCase):
    def setUp(self):
        tmp_folder = tempfile.gettempdir()
        unique_id = str(uuid.uuid1())
        self.tmp_genome = os.path.join(tmp_folder, unique_id + "_in.fa")
        self.tmp_fai = os.path.join(tmp_folder, unique_id + "_in.fa.fai")
        self.tmp_in = os.path.join(tmp_folder, unique_id + "_in.vcf")
        self.tmp_out = os.path.join(tmp_folder, unique_id + "_out.vcf")
        self.cmd = [
            "standardizeBND.py",
            "--sequence-padding", "20",
            "--input-genome", self.tmp_genome,
            "--input-variants", self.tmp_in,
            "--output-variants", self.tmp_out
        ]
        with open(self.tmp_fai, "w") as writer:
            writer.write("""1	41	3	41	42
2	41	48	41	42
3	41	93	41	42
4	41	138	41	42
5	41	183	41	42
6	41	228	41	42
7	41	273	41	42
8	41	318	41	42
9	41	363	41	42
10	41	409	41	42
11	41	455	41	42
12	41	501	41	42
13	41	547	41	42
14	41	593	41	42
15	41	639	41	42
16	41	685	41	42
17	41	731	41	42
18	41	777	41	42
19	41	823	41	42
20	41	869	41	42
21	41	915	41	42
22	41	961	41	42
23	41	1007	41	42
24	41	1053	41	42
25	41	1099	41	42
26	41	1145	41	42
27	41	1191	41	42
28	41	1237	41	42
29	41	1283	41	42
30	41	1329	41	42
31	41	1375	41	42
32	41	1421	41	42
33	41	1467	41	42
34	41	1513	41	42
35	41	1559	41	42
36	41	1605	41	42""")
        with open(self.tmp_genome, "w") as writer:
            writer.write(""">1
CCCCAAGTGGATGCACTTACTTCGAGGTTCTCGGGGCCCAT
>2
TGGAGTGCTTCTCAGTACGATCTGGAGGATGCCACCAGGAA
>3
AGTACAGTGCACTTCATACACATACACATACACACATACAC
>4
GCACACACACACACACACACATACACACACACTCTCTCTCA
>5
AGTCCAGCTCGGCGGCTCACCTGTGCAGAAGCAGCGGCAGA
>6
TTTTTCCAGTCATCACCAGGTCTAGAGAGAATACAGTAAAC
>7
ACATACATACATACATACACACACACATACACACACACATA
>8
CGCACACACACACACACACACATACACACACACTCTCTCTC
>9
TTCAAAGAAAAAAAAAATTAGCTGGACATGATGGTGGGTGC
>10
GTGAGCATGGTTTTTAAATTTGCAGCACAAACTCGACTATC
>11
AAGAGAGAGTTCAAGAGGGCGTGAAACCGTTAAGAGGTAAA
>12
TTTTATTCTTTAAATTGCAGGTTCTGTCAGTGTGTGTGGAA
>13
TCTTCCTCCTTACCCTACCCCCCACTCACACACACACACAC
>14
TGCATCTGTCTCCACACACACCCACACACACACACACACAC
>15
CCCAAGTAGCTGGAACTACAGGTGTGCACCACCACACAAGG
>16
ATCTTCTTTTGGCTTCTCAGGAATCCATACCTGTTTTGTAT
>17
ACCTAAATCCAGAATTTGAGTTTGGGGGGGAAAAAAAAAAC
>18
CTGTGATTTCACTTTCGCAGAAAATGAAACTGAAGCCGTGG
>19
GTATATATATATATATATATGAACCCAGAAAAAAAACTTAT
>20
GATTGCACAGCTCTTCATATATATATATATATATATATATA
>21
CTGGGCGTAGTGGCACATGCCTGTAATTCCAGCTACTTGGG
>22
GTTCTCTTACCCTTACCTAGTTTCCAACCGGAGGCCCTATC
>23
CTGGGCGTAGTGGCACATGCCTGTAATTCCAGCTACTTGGG
>24
ATCTTCTTTTGGCTTCTCAGGAATCCATACCTGTTTTGTAT
>25
TGCAATGTTTTTGTGGAACATGGTGAGTGCTTTTCAAAATT
>26
CAGGTGGCAAAGGGTGGGATGCTGTGCAAGAGAAAATACAG
>27
CCGCGCCCTCTCTCTCTCTCTCTCCCCCGCTCCCCGTCCTC
>28
AGTTGGAAGGCATACTGGGGAAGAGATGTTCCCAAGTAACC
>29
GCTTTCTTCCTCCTTACCCTACCCCCCACTCACACACACAC
>30
GTGTGTGTGTGTGTGGGGGGGGTGAATATAGTTGTCACTCT
>31
TTATTACAGTTACCAGAACAGGTAAGCTTGGCCAGGTGTGG
>32
CACTTCTCACAGAAATGATACCTGTCAGCAAGAAGGCCATA
>33
GGCTCTCAAGGCATTAAAGCAGAAGACCGAAGGGGAATCTG
>34
CAATTATTCCCCTTCGGTCTTAAAAATATATTTCCTCATAA
>35
AAGAAGGAATCATAGGTAATTTCATCAACTCAGCACGATTT
>36
GAAGACTATTTTGGTGAATCACCTTCAGTGAACAAATGCCT""")
        with open(self.tmp_in, "w") as writer:
            writer.write("""##fileformat=VCFv4.3
##INFO=<ID=CIPOS,Number=2,Type=Integer,Description="Confidence interval around POS">
##INFO=<ID=IMPRECISE,Number=0,Type=Flag,Description="Imprecise structural variation.">
##INFO=<ID=MATEID,Number=A,Type=String,Description="ID of mate breakend.">
##INFO=<ID=RNA_FIRST,Number=0,Type=Flag,Description="For RNA fusions, this break-end is 5' in the fusion transcript.">
##INFO=<ID=SVTYPE,Number=1,Type=String,Description="Type of structural variant.">
#CHROM	POS	ID	REF	ALT	QUAL	FILTER	INFO
# -- no_cipos no_move 0 0: 21:34859474=T/]8:92017363]T => 21:34859474=T/]8:92017363]T   8:92017363=T/T[21:34859474[ => 8:92017363=T/T[21:34859474[
1	21	MantaBND:310:0:2:0:2:0:1	T	]2:21]T	.	PASS	MATEID=MantaBND%3A310%3A0%3A2%3A0%3A2%3A0%3A0;RNA_FIRST;SVTYPE=BND
2	21	MantaBND:310:0:2:0:2:0:0	T	T[1:21[	.	PASS	MATEID=MantaBND%3A310%3A0%3A2%3A0%3A2%3A0%3A1;SVTYPE=BND
# -- with_cipos move_to_up -3 0: 5:158934311=N/]1:150811478]N => 5:158934308=A/]1:150811475]A [0, 3]  1:150811478=N/N[5:158934311[ => 1:150811475=C/C[5:158934308[ [0, 3]
3	21	64ce989a-1a96-497b-b522-88e7dfb32640	N	]4:21]N	.	PASS	MATEID=81af2743-373f-4310-b4c4-6402b03b78e9;RNA_FIRST;SVTYPE=BND
4	21	81af2743-373f-4310-b4c4-6402b03b78e9	N	N[3:21[	.	PASS	MATEID=64ce989a-1a96-497b-b522-88e7dfb32640;SVTYPE=BND
# -- with_cipos move_to_down 0 2: X:1536921=N/]11:118781184]N => X:1536921=C/]11:118781184]C [0, 2]  11:118781184=N/N[X:1536921[ => 11:118781184=T/T[X:1536921[ [0, 2]
5	21	8766c3af-c709-44ea-bb19-a3827335178f	N	]6:21]N	.	PASS	MATEID=892b1955-cf67-4a05-ab04-baa4709f07e1;RNA_FIRST;SVTYPE=BND
6	21	892b1955-cf67-4a05-ab04-baa4709f07e1	N	N[5:21[	.	PASS	MATEID=8766c3af-c709-44ea-bb19-a3827335178f;SVTYPE=BND
# -- with_cipos extend -4 1: 17:3824348=N/]1:150811477]N => 17:3824344=A/]1:150811473]A [0, 5]  1:150811477=N/N[17:3824348[ => 1:150811473=C/C[17:3824344[ [0, 5]
7	21	3d63ff4d-7238-4f17-a1ef-f9c1014989a5	N	]8:21]N	.	PASS	MATEID=b7d4e3fc-8962-47bb-8786-2d3a23a6f6bd;RNA_FIRST;SVTYPE=BND
8	21	b7d4e3fc-8962-47bb-8786-2d3a23a6f6bd	N	N[7:21[	.	PASS	MATEID=3d63ff4d-7238-4f17-a1ef-f9c1014989a5;SVTYPE=BND
# ++ no_cipos no_move 0 0: 17:80373857=N/N[9:121115086[ => 17:80373857=G/G[9:121115086[   9:121115086=N/]17:80373857]N => 9:121115086=T/]17:80373857]T
9	21	25fb8488-4d1f-4501-a292-c13ee3c15def	N	N[10:21[	.	PASS	MATEID=1b11b081-4641-42b4-a5f8-718421f51591;RNA_FIRST;SVTYPE=BND
10	21	1b11b081-4641-42b4-a5f8-718421f51591	N	]9:21]N	.	PASS	MATEID=25fb8488-4d1f-4501-a292-c13ee3c15def;SVTYPE=BND
# ++ with_cipos move_to_up -1 0: 21:8258523=N/N[17:59660391[ => 21:8258522=C/C[17:59660390[ [0, 1]  17:59660391=N/]21:8258523]N => 17:59660390=G/]21:8258522]G [0, 1]
11	21	fbefa388-ee78-471e-a48b-53ed2fef18f4	N	N[12:21[	.	PASS	MATEID=c70c4839-b235-4e99-91da-36c948460a11;RNA_FIRST;SVTYPE=BND
12	21	c70c4839-b235-4e99-91da-36c948460a11	N	]11:21]N	.	PASS	MATEID=fbefa388-ee78-471e-a48b-53ed2fef18f4;SVTYPE=BND
# ++ with_cipos move_to_down 0 2: 22:41179875=N/N[12:26649201[ => 22:41179875=C/C[12:26649201[ [0, 2]  12:26649201=N/]22:41179875]N => 12:26649201=C/]22:41179875]C [0, 2]
13	21	c0dce868-0a1e-4dd3-ab7f-89937d83e680	N	N[14:21[	.	PASS	MATEID=de463e53-7c19-438f-afd8-c10a6079b368;RNA_FIRST;SVTYPE=BND
14	21	de463e53-7c19-438f-afd8-c10a6079b368	N	]13:21]N	.	PASS	MATEID=c0dce868-0a1e-4dd3-ab7f-89937d83e680;SVTYPE=BND
# ++ with_cipos extend -3 1: 19:16095893=N/N[5:177256951[ => 19:16095890=A/A[5:177256948[ [0, 4]  5:177256951=N/]19:16095893]N => 5:177256948=C/]19:16095890]C [0, 4]
15	21	29d287e8-5a6c-47e5-b465-ac0bcb5c0e7b	N	N[16:21[	.	PASS	MATEID=c4971697-4c9d-456e-80f6-d3f5d2107f11;RNA_FIRST;SVTYPE=BND
16	21	c4971697-4c9d-456e-80f6-d3f5d2107f11	N	]15:21]N	.	PASS	MATEID=29d287e8-5a6c-47e5-b465-ac0bcb5c0e7b;SVTYPE=BND
# -+ no_cipos no_move 0 0: 17:1650592=N/[17:80263574[N => 17:1650592=T/[17:80263574[T   17:80263574=N/[17:1650592[N => 17:80263574=A/[17:1650592[A
17	21	38f07548-1cab-4114-8edf-5fede620a809	N	[18:21[N	.	PASS	MATEID=c7b27813-7a41-439a-8b49-3512766c2e1f;RNA_FIRST;SVTYPE=BND
18	21	c7b27813-7a41-439a-8b49-3512766c2e1f	N	[17:21[N	.	PASS	MATEID=38f07548-1cab-4114-8edf-5fede620a809;SVTYPE=BND
# -+ with_cipos move_to_up -19 0: 11:118751087=N/[10:74830736[N => 11:118751068=T/[10:74830755[T [0, 19]  10:74830736=N/[11:118751087[N => 10:74830736=A/[11:118751087[A [0, 19]
19	21	cca2eb55-8fc9-4d68-8c14-13bd5991b6d7	N	[20:21[N	.	PASS	MATEID=17964d6f-e3ff-4bb3-83e6-367bad292116;RNA_FIRST;SVTYPE=BND
20	21	17964d6f-e3ff-4bb3-83e6-367bad292116	N	[19:21[N	.	PASS	MATEID=cca2eb55-8fc9-4d68-8c14-13bd5991b6d7;SVTYPE=BND
# -+ with_cipos move_to_down 0 2: 1:154173539=N/[5:177204120[N => 1:154173539=C/[5:177204120[C [0, 2]  5:177204120=N/[1:154173539[N => 5:177204118=A/[1:154173541[A [0, 2]
21	21	6b5cc564-1329-41c2-a509-2e940136e30b	N	[22:21[N	.	PASS	MATEID=114c8892-c5d8-4f1c-8c09-490ff030be44;RNA_FIRST;SVTYPE=BND
22	21	114c8892-c5d8-4f1c-8c09-490ff030be44	N	[21:21[N	.	PASS	MATEID=6b5cc564-1329-41c2-a509-2e940136e30b;SVTYPE=BND
# -+ with_cipos extend -1 3: 1:154173539=N/[5:177256951[N => 1:154173538=C/[5:177256952[C [0, 4]  5:177256951=N/[1:154173539[N => 5:177256948=C/[1:154173542[C [0, 4]
23	21	be485319-0082-4d0a-a976-794b7fd42d53	N	[24:21[N	.	PASS	MATEID=4997ab9e-9ee7-4b74-8348-dca268f14b40;RNA_FIRST;SVTYPE=BND
24	21	4997ab9e-9ee7-4b74-8348-dca268f14b40	N	[23:21[N	.	PASS	MATEID=be485319-0082-4d0a-a976-794b7fd42d53;SVTYPE=BND
# +- no_cipos no_move 0 0: 9:130714454=T/T]1:25918294] => 9:130714454=T/T]1:25918294]   1:25918293=G/G]9:130714455] => 1:25918293=G/G]9:130714455]
25	21	MantaBND:2:0:1:0:0:0:1	T	T]26:21]	.	PASS	MATEID=MantaBND%3A2%3A0%3A1%3A0%3A0%3A0%3A0;RNA_FIRST;SVTYPE=BND
26	21	MantaBND:2:0:1:0:0:0:0	G	G]25:21]	.	PASS	MATEID=MantaBND%3A2%3A0%3A1%3A0%3A0%3A0%3A1;SVTYPE=BND
# +- with_cipos move_to_up -5 0: 21:8216940=N/N]1:154171611] => 21:8216935=C/C]1:154171616] [0, 5]  1:154171611=N/N]21:8216940] => 1:154171611=A/A]21:8216940] [0, 5]
27	21	8df2a5e2-fd7e-474b-a4e8-73b3939607ad	N	N]28:21]	.	PASS	MATEID=ea09c70c-4fa3-46a6-ba11-40132671d0bb;RNA_FIRST;SVTYPE=BND
28	21	ea09c70c-4fa3-46a6-ba11-40132671d0bb	N	N]27:21]	.	PASS	MATEID=8df2a5e2-fd7e-474b-a4e8-73b3939607ad;SVTYPE=BND
# +- with_cipos move_to_down 0 6: 22:41179871=N/N]2:89321704] => 22:41179871=A/A]2:89321704] [0, 6]  2:89321704=N/N]22:41179871] => 2:89321698=G/G]22:41179877] [0, 6]
29	21	438e2187-2e71-4ebe-beec-6b275dc4a45b	N	N]30:21]	.	PASS	MATEID=f77d3a46-4532-4f82-9223-ba4adc33ef68;RNA_FIRST;SVTYPE=BND
30	21	f77d3a46-4532-4f82-9223-ba4adc33ef68	N	N]29:21]	.	PASS	MATEID=438e2187-2e71-4ebe-beec-6b275dc4a45b;SVTYPE=BND
# +- with_cipos extend -4 3: 22:41158500=N/N]16:3751806] => 22:41158496=A/A]16:3751810] [0, 7]  16:3751806=N/N]22:41158500] => 16:3751803=A/A]22:41158503] [0, 7]
31	21	0162d4c4-a448-4039-8246-ef0d82a4e930	N	N]32:21]	.	PASS	MATEID=d3692b46-d825-475e-9c48-65cb3fe39b7c;RNA_FIRST;SVTYPE=BND
32	21	d3692b46-d825-475e-9c48-65cb3fe39b7c	N	N]31:21]	.	PASS	MATEID=0162d4c4-a448-4039-8246-ef0d82a4e930;SVTYPE=BND
# IMPRECISE with CIPOS and with known ref: 8:25399040=A/[7:50402680[A => 8:25399040=A/[7:50402680[A [-19, 20]  7:50402680=T/[8:25399040[T => 7:50402680=T/[8:25399040[T [-19, 20]
33	21	MantaBND:288:11:13:0:0:0:1	A	[34:21[A	.	PASS	CIPOS=-19,20;IMPRECISE;MATEID=MantaBND%3A288%3A11%3A13%3A0%3A0%3A0%3A0;RNA_FIRST;SVTYPE=BND
34	21	MantaBND:288:11:13:0:0:0:0	T	[33:21[T	.	PASS	CIPOS=-19,20;IMPRECISE;MATEID=MantaBND%3A288%3A11%3A13%3A0%3A0%3A0%3A1;SVTYPE=BND
# IMPRECISE without CIPOS and with unknown ref: 8:38299494=N/]7:92614584]N => 8:38299494=T/]7:92614584]T   7:92614584=N/N[8:38299494[ => 7:92614584=A/A[8:38299494[
35	21	a258abe3-31e6-483b-b463-fcca36cc848f	N	]36:21]N	.	PASS	IMPRECISE;MATEID=2c4739b6-b750-4c5e-b10a-491538aae408;RNA_FIRST;SVTYPE=BND
36	21	2c4739b6-b750-4c5e-b10a-491538aae408	N	N[35:21[	.	PASS	IMPRECISE;MATEID=a258abe3-31e6-483b-b463-fcca36cc848f;SVTYPE=BND""")
        self.expected = """##fileformat=VCFv4.3
##INFO=<ID=CIPOS,Number=2,Type=Integer,Description="Confidence interval around POS">
##INFO=<ID=IMPRECISE,Number=0,Type=Flag,Description="Imprecise structural variation.">
##INFO=<ID=MATEID,Number=A,Type=String,Description="ID of mate breakend.">
##INFO=<ID=RNA_FIRST,Number=0,Type=Flag,Description="For RNA fusions, this break-end is 5' in the fusion transcript.">
##INFO=<ID=SVTYPE,Number=1,Type=String,Description="Type of structural variant.">
#CHROM	POS	ID	REF	ALT	QUAL	FILTER	INFO
1	21	MantaBND:310:0:2:0:2:0:1	T	]2:21]T	.	PASS	MATEID=MantaBND%3A310%3A0%3A2%3A0%3A2%3A0%3A0;RNA_FIRST;SVTYPE=BND
2	21	MantaBND:310:0:2:0:2:0:0	T	T[1:21[	.	PASS	MATEID=MantaBND%3A310%3A0%3A2%3A0%3A2%3A0%3A1;SVTYPE=BND
3	18	64ce989a-1a96-497b-b522-88e7dfb32640	A	]4:18]A	.	PASS	CIPOS=0,3;MATEID=81af2743-373f-4310-b4c4-6402b03b78e9;RNA_FIRST;SVTYPE=BND
4	18	81af2743-373f-4310-b4c4-6402b03b78e9	C	C[3:18[	.	PASS	CIPOS=0,3;MATEID=64ce989a-1a96-497b-b522-88e7dfb32640;SVTYPE=BND
5	21	8766c3af-c709-44ea-bb19-a3827335178f	C	]6:21]C	.	PASS	CIPOS=0,2;MATEID=892b1955-cf67-4a05-ab04-baa4709f07e1;RNA_FIRST;SVTYPE=BND
6	21	892b1955-cf67-4a05-ab04-baa4709f07e1	T	T[5:21[	.	PASS	CIPOS=0,2;MATEID=8766c3af-c709-44ea-bb19-a3827335178f;SVTYPE=BND
7	17	3d63ff4d-7238-4f17-a1ef-f9c1014989a5	A	]8:17]A	.	PASS	CIPOS=0,5;MATEID=b7d4e3fc-8962-47bb-8786-2d3a23a6f6bd;RNA_FIRST;SVTYPE=BND
8	17	b7d4e3fc-8962-47bb-8786-2d3a23a6f6bd	C	C[7:17[	.	PASS	CIPOS=0,5;MATEID=3d63ff4d-7238-4f17-a1ef-f9c1014989a5;SVTYPE=BND
9	21	25fb8488-4d1f-4501-a292-c13ee3c15def	G	G[10:21[	.	PASS	MATEID=1b11b081-4641-42b4-a5f8-718421f51591;RNA_FIRST;SVTYPE=BND
10	21	1b11b081-4641-42b4-a5f8-718421f51591	T	]9:21]T	.	PASS	MATEID=25fb8488-4d1f-4501-a292-c13ee3c15def;SVTYPE=BND
11	20	fbefa388-ee78-471e-a48b-53ed2fef18f4	C	C[12:20[	.	PASS	CIPOS=0,1;MATEID=c70c4839-b235-4e99-91da-36c948460a11;RNA_FIRST;SVTYPE=BND
12	20	c70c4839-b235-4e99-91da-36c948460a11	G	]11:20]G	.	PASS	CIPOS=0,1;MATEID=fbefa388-ee78-471e-a48b-53ed2fef18f4;SVTYPE=BND
13	21	c0dce868-0a1e-4dd3-ab7f-89937d83e680	C	C[14:21[	.	PASS	CIPOS=0,2;MATEID=de463e53-7c19-438f-afd8-c10a6079b368;RNA_FIRST;SVTYPE=BND
14	21	de463e53-7c19-438f-afd8-c10a6079b368	C	]13:21]C	.	PASS	CIPOS=0,2;MATEID=c0dce868-0a1e-4dd3-ab7f-89937d83e680;SVTYPE=BND
15	18	29d287e8-5a6c-47e5-b465-ac0bcb5c0e7b	A	A[16:18[	.	PASS	CIPOS=0,4;MATEID=c4971697-4c9d-456e-80f6-d3f5d2107f11;RNA_FIRST;SVTYPE=BND
16	18	c4971697-4c9d-456e-80f6-d3f5d2107f11	C	]15:18]C	.	PASS	CIPOS=0,4;MATEID=29d287e8-5a6c-47e5-b465-ac0bcb5c0e7b;SVTYPE=BND
17	21	38f07548-1cab-4114-8edf-5fede620a809	T	[18:21[T	.	PASS	MATEID=c7b27813-7a41-439a-8b49-3512766c2e1f;RNA_FIRST;SVTYPE=BND
18	21	c7b27813-7a41-439a-8b49-3512766c2e1f	A	[17:21[A	.	PASS	MATEID=38f07548-1cab-4114-8edf-5fede620a809;SVTYPE=BND
19	2	cca2eb55-8fc9-4d68-8c14-13bd5991b6d7	T	[20:40[T	.	PASS	CIPOS=0,19;MATEID=17964d6f-e3ff-4bb3-83e6-367bad292116;RNA_FIRST;SVTYPE=BND
20	21	17964d6f-e3ff-4bb3-83e6-367bad292116	A	[19:21[A	.	PASS	CIPOS=0,19;MATEID=cca2eb55-8fc9-4d68-8c14-13bd5991b6d7;SVTYPE=BND
21	21	6b5cc564-1329-41c2-a509-2e940136e30b	C	[22:21[C	.	PASS	CIPOS=0,2;MATEID=114c8892-c5d8-4f1c-8c09-490ff030be44;RNA_FIRST;SVTYPE=BND
22	19	114c8892-c5d8-4f1c-8c09-490ff030be44	A	[21:23[A	.	PASS	CIPOS=0,2;MATEID=6b5cc564-1329-41c2-a509-2e940136e30b;SVTYPE=BND
23	20	be485319-0082-4d0a-a976-794b7fd42d53	C	[24:22[C	.	PASS	CIPOS=0,4;MATEID=4997ab9e-9ee7-4b74-8348-dca268f14b40;RNA_FIRST;SVTYPE=BND
24	18	4997ab9e-9ee7-4b74-8348-dca268f14b40	C	[23:24[C	.	PASS	CIPOS=0,4;MATEID=be485319-0082-4d0a-a976-794b7fd42d53;SVTYPE=BND
25	21	MantaBND:2:0:1:0:0:0:1	T	T]26:21]	.	PASS	MATEID=MantaBND%3A2%3A0%3A1%3A0%3A0%3A0%3A0;RNA_FIRST;SVTYPE=BND
26	21	MantaBND:2:0:1:0:0:0:0	G	G]25:21]	.	PASS	MATEID=MantaBND%3A2%3A0%3A1%3A0%3A0%3A0%3A1;SVTYPE=BND
27	16	8df2a5e2-fd7e-474b-a4e8-73b3939607ad	C	C]28:26]	.	PASS	CIPOS=0,5;MATEID=ea09c70c-4fa3-46a6-ba11-40132671d0bb;RNA_FIRST;SVTYPE=BND
28	21	ea09c70c-4fa3-46a6-ba11-40132671d0bb	A	A]27:21]	.	PASS	CIPOS=0,5;MATEID=8df2a5e2-fd7e-474b-a4e8-73b3939607ad;SVTYPE=BND
29	21	438e2187-2e71-4ebe-beec-6b275dc4a45b	A	A]30:21]	.	PASS	CIPOS=0,6;MATEID=f77d3a46-4532-4f82-9223-ba4adc33ef68;RNA_FIRST;SVTYPE=BND
30	15	f77d3a46-4532-4f82-9223-ba4adc33ef68	G	G]29:27]	.	PASS	CIPOS=0,6;MATEID=438e2187-2e71-4ebe-beec-6b275dc4a45b;SVTYPE=BND
31	17	0162d4c4-a448-4039-8246-ef0d82a4e930	A	A]32:25]	.	PASS	CIPOS=0,7;MATEID=d3692b46-d825-475e-9c48-65cb3fe39b7c;RNA_FIRST;SVTYPE=BND
32	18	d3692b46-d825-475e-9c48-65cb3fe39b7c	A	A]31:24]	.	PASS	CIPOS=0,7;MATEID=0162d4c4-a448-4039-8246-ef0d82a4e930;SVTYPE=BND
33	21	MantaBND:288:11:13:0:0:0:1	A	[34:21[A	.	PASS	CIPOS=-19,20;IMPRECISE;MATEID=MantaBND%3A288%3A11%3A13%3A0%3A0%3A0%3A0;RNA_FIRST;SVTYPE=BND
34	21	MantaBND:288:11:13:0:0:0:0	T	[33:21[T	.	PASS	CIPOS=-19,20;IMPRECISE;MATEID=MantaBND%3A288%3A11%3A13%3A0%3A0%3A0%3A1;SVTYPE=BND
35	21	a258abe3-31e6-483b-b463-fcca36cc848f	T	]36:21]T	.	PASS	IMPRECISE;MATEID=2c4739b6-b750-4c5e-b10a-491538aae408;RNA_FIRST;SVTYPE=BND
36	21	2c4739b6-b750-4c5e-b10a-491538aae408	A	A[35:21[	.	PASS	IMPRECISE;MATEID=a258abe3-31e6-483b-b463-fcca36cc848f;SVTYPE=BND"""

    def tearDown(self):
        # Clean temporary files
        for curr_file in [self.tmp_in, self.tmp_out, self.tmp_genome, self.tmp_fai]:
            if os.path.exists(curr_file):
                os.remove(curr_file)

    def testExec(self):
        # Execute command
        subprocess.check_call(self.cmd, stderr=subprocess.DEVNULL)
        # Compare
        observed = []
        with open(self.tmp_out) as reader:
            observed = reader.read().strip()
        for curr_exp, curr_obs in zip(self.expected.split("\n"), observed.split("\n")):
            self.assertEqual(curr_exp, curr_obs)


########################################################################
#
# MAIN
#
########################################################################
if __name__ == "__main__":
    unittest.main()
